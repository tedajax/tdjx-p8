pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
function _init()
	dt=1/30

	tape={
		x=64,y=64,
		w=16,h=16,
	}
	
	pl={14,8,10,11,12}
	pli=0
	
	init_sequences()
	interval(function() pli+=1 end,4/30)
end


function _update()
	tick_sequences()

	tape.y=64+sin(t()/2.5)*8
end

function _draw()
	cls(0)
	
	for i=1,#pl do
		local j=(pli+i-1)%#pl+1
		pal(pl[i],pl[j])
	end
	
	spr(1,
		tape.x-tape.w,
		tape.y-tape.h,4,4)
		
	pal()
end

function wait_sec(n)
	while n>0 do
		n-=dt
		yield()
	end
end

function init_sequences()
	_sequences={}
end

function tick_sequences()
	for c in all(_sequences) do
		if c and costatus(c)~="dead" then
			assert(coresume(c))
		else
			del(coroutines,c)
		end
	end
end

function sequence(fn)
	add(_sequences,cocreate(fn))
end

function defer(fn,delay)
	sequence(function()
		wait_sec(delay or 0)
		fn()
	end)
end

function rep(fn,ivl)
	return function()
		fn()
		defer(rep(fn,ivl),ivl)
	end
end

function interval(fn,ivl)
	defer(rep(fn,ivl),ivl)
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777777777777771111111777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777777777777777111117777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777777777777777711177777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777777777777777771777777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777777777777777777777777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777777777777777777777777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000007116777711d7cccbbbaaa888eee71700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000711777771177cccbbbaaa888eee71700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000007116777711d7cccbbbaaa888eee71700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000711777771177cccbbbaaa888eee77700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000007116777711d7cccbbbaaa888eee77700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000711777771177cccbbbaaa888eee71700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000007116777711d7cccbbbaaa888eee71700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000711777777777cccbbbaaa888eee77700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000007116777777d7cccbbbaaa888eee71700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000711777777777cccbbbaaa888eee71700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000007776777777d7cccbbbaaa888eee77700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
