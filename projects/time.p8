pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
function _init()
	players={}
	active=make_player()
	active.ctrl=control_player_record
end

function _update()
	foreach(players,update_player)
end

function _draw()
	foreach(players,draw_player)
end

function control_player_record(pl)
	local ix,iy=0,0
	if (btn(0)) ix-=1
	if (btn(1)) ix+=1
	if (btn(2)) iy-=1
	if (btn(3)) iy+=1
	
	pl.inp.x=ix
	pl.inp.y=iy
	
	add(pl.rec,{
		x=pl.inp.x
		y=pl.inp.y
	})
end

function control_player_playback(pl)
end

function make_player()
	local pl={}
	pl.x=63
	pl.y=63
	-- half width
	pl.w=4
	pl.h=4
	pl.dx=0
	pl.dy=0
	pl.ctrl=nil
	
	pl.inp={}
	pl.inp.x=0
	pl.inp.y=0
	pl.inp.shoot=false
	
	pl.rec={}
	return add(players,pl)
end

function update_player(pl)
	if pl.ctrl~= nil then
		pl.ctrl(pl)
	end
	
	local ix,iy=norm(pl.inp.x,pl.inp.y)
	pl.dx=ix
	pl.dy=iy
	
	pl.x+=pl.dx
	pl.y+=pl.dy
end

function draw_player(pl)
	spr(1,pl.x-pl.w,pl.y-pl.h)
end

function mag(x,y)
	return sqrt(x*x+y*y)
end

function norm(x,y)
	local l=mag(x,y)
	if (l>0) return x/l,y/l
	return 0,0
end
__gfx__
00000000006666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770006dd66dd60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700666dd6660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066dd6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
