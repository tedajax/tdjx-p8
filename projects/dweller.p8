pico-8 cartridge // http://www.pico-8.com
version 16
__lua__

function _init()
	gravity=.03

	cam={}
	cam.x=64
	cam.y=64

	plr={}
	plr.x=64
	plr.y=64
	plr.r=0
	plr.dx=0
	plr.dy=0

	-- turn speed
	plr.trnspd=0.03

	plr.drag=0.02

	-- throttle force
	plr.thfrc=0.2

	-- max speed
	plr.spdmx=2
end

function _update()
	local ix,iy=0,0
	if (btn(0)) ix+=1
	if (btn(1)) ix-=1
	if (btn(2)) iy+=1
	if (btn(3)) iy-=1

	plr.r+=ix*plr.trnspd

	local throt=max(iy,0)
	local fx=cos(plr.r)*plr.thfrc*throt
	local fy=sin(plr.r)*plr.thfrc*throt

	plr.dx+=fx
	plr.dy+=fy

	local spd=mag(plr.dx,plr.dy)
	local nx,ny=norm(plr.dx,plr.dy)

	if spd>plr.spdmx then
		plr.dx=nx*plr.spdmx
		plr.dy=ny*plr.spdmx
	end

	if spd>0 then
		local drx,dry=-nx*plr.drag,
			-ny*plr.drag

		local sgnx,sgny=sgn(plr.dx),
			sgn(plr.dy)

		plr.dx+=drx
		plr.dy+=dry

		if (sgn(plr.dx)~=sgnx) plr.dx=0
		if (sgn(plr.dy)~=sgny) plr.dy=0
	end

	plr.dy+=gravity

	plr.x+=plr.dx
	plr.y+=plr.dy

	cam.x,cam.y=plr.x,plr.y
end

function _draw()
	cls()

	camera(cam.x-64,cam.y-64)
	--circ(plr.x,plr.y,6,11)
	-- line(plr.x,plr.y,
	-- 	plr.x+cos(plr.r)*6,
	-- 	plr.y+sin(plr.r)*6,
	-- 	11)
	rspr(16,plr.x,plr.y,plr.r)

	map(0,0,0,0,30,30)

	camera()
	print(msg,0,0,7)
end

function rspr(sp,x,y,r,w,h)
	while (r<0) do r+=1 end
	while (r>=1) do r-=1 end

	local base=0
	local flx,fly=false,false
	if r>=.75 then
		base=.75
		fly=false,true
	elseif r>=.5 then
		base=.5
		flx,fly=false,true
	elseif r>=.25 then
		base=.25
		flx=true
	end

	local lr=(r-base)/.25

	w=w or 1
	h=h or 1
	spr(sp+flr(lr*4),x,y,w,h,flx,fly)

	msg=r.."-"..base.."="..r-base
end
msg=""

function mag(x,y)
	return sqrt(x*x+y*y)
end

function mag2(x,y)
	return x*x+y*y
end

function norm(x,y,l)
	local l=mag(x,y)
	if (l>0) return x/l,y/l
	return 0,0
end

function sgn(n)
	if n==0 then return 0
	elseif n>0 then return 1
	else return -1 end
end

function lerp(a,b,t)
	return a+(b-a)*t
end

__gfx__
00000000555655550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555655550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700555655550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000555655550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700555655550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555655550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555655550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0cc000000000000000000cc00000cc00000cc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0cccc0000cccccc0000cccc0000ccc00000cc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0cccccc00cccccc00ccccc0000cccc0000cccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0cccccc000cccc0000cccc000ccccc0000cccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0cccc00000ccc000000cc00000cccc000cccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0cc00000000c00000000c0000000cc000cccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
