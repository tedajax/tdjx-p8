pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
function _init()
	ship={
		x=64,y=64,r=0,
		dx=0,dy=0,
		thrust=0,
		throttle=0,
	}
end

function _update60()
	local ix,iy=0,0
	local pid=0
	
	if (btn(0,pid)) ix-=1
	if (btn(1,pid)) ix+=1
	if (btn(2,pid)) iy-=1
	if (btn(3,pid)) iy+=1
	
	ship.r-=ix*0.0125
	
	if btn(5) then
		ship.throttle=1
	else
		ship.throttle=0
	end
	ship.throttle=mid(
		ship.throttle,0,1)
	
	mr=clamp_8way(ship.r)
	
	local fric=0.033/2
	if ship.throttle==0 then
		local nx,ny=norm(ship.dx,ship.dy)
		local fx,fy=-nx*fric,-ny*fric
		ship.dx+=fx
		ship.dy+=fy
		local nx1,ny1=norm(ship.dx,ship.dy)
		if dot(nx,ny,nx1,ny1)<0 then
			ship.dx=0
			ship.dy=0
		end
	end

	ship.thrust=ship.throttle*0.1/2
	ship.dx+=ship.thrust*cos(mr)
	ship.dy+=ship.thrust*sin(mr)
	
	local spd=len(ship.dx,ship.dy)
	local maxspd=1.9/2
	if spd>maxspd then
		local nx,ny=norm(ship.dx,ship.dy)
		ship.dx=nx*maxspd
		ship.dy=ny*maxspd
	end
	
	ship.x+=ship.dx
	ship.y+=ship.dy
	
	local border=9
	local size=128+border*2
	if (ship.x<-border) ship.x+=size
	if (ship.x>128+border) ship.x-=size
	if (ship.y<-border) ship.y+=size
	if (ship.y>128+border) ship.y-=size
end

function _draw()
	cls()
	if ship.throttle==0 then
		pal(9,0)
	elseif blink(0.1) then
		pal(9,7)
	else
		pal()
	end
	sprr(16,ship.x,ship.y,ship.r)
		print(mr,0,0,11)
		print(len(ship.dx,ship.dy),0,6,11)
	line(63,127,63+ship.throttle*64,127,10)
end

function sprr(sp,x,y,r)
	cr=r
	x=x or 0
	y=y or 0
	r=clamp_8way(r)
	spr(sp+r*8,x-4,y-4)
end

function clamp_8way(r)
	r=r or 0
	return flr(((r+0.0625)%1)*8)/8
end
-->8
function len2(x,y)
	return x*x+y*y
end

function len(x,y)
	return sqrt(len2(x,y))
end

function norm(x,y)
	local l=len(x,y)
	if (l==0) return 0,0
	return x/l,y/l
end

function dot(x0,y0,x1,y1)
	return x0*x1+y0*y1
end

function blink(ivl,tt)
	tt=tt or t()
	return flr((tt*2)/ivl)%2==0
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000cc00000000000000000000000100000099000000100000000000000000000000000000000000000000000000000000000000000000000
011110000001ccc0000770000ccc1000000111100001cc9001cccc1009cc10000000000000000000000000000000000000000000000000000000000000000000
0ccccc00001c77c000c77c000c77c10000ccccc0001cccc001cccc100cccc1000000000000000000000000000000000000000000000000000000000000000000
9cccc77c01cc77c001cccc100c77cc10c77cccc901ccccc101cccc101ccccc100000000000000000000000000000000000000000000000000000000000000000
9cccc77c1ccccc1001cccc1001ccccc1c77cccc90c77cc1001cccc1001cc77c00000000000000000000000000000000000000000000000000000000000000000
0ccccc000cccc10001cccc10001cccc000ccccc00c77c10000c77c00001c77c00000000000000000000000000000000000000000000000000000000000000000
0111100009cc100001cccc100001cc90000111100ccc1000000770000001ccc00000000000000000000000000000000000000000000000000000000000000000
000000000001000000099000000010000000000000000000000cc000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000aa0000aa0000aa00000000000000000a90000a99a00009a00000000000000000000000000000000000000000000000000000000000000000000
0aa00000000099a0000aa0000a99000000000aa0000a999000a99a000999a0000000000000000000000000000000000000000000000000000000000000000000
09999aa000a999000009900000999a000aa99990000999a0000990000a9990000000000000000000000000000000000000000000000000000000000000000000
09999aa00a99900000099000000999a00aa9999000999a000009900000a999000000000000000000000000000000000000000000000000000000000000000000
0aa000000999a00000a99a00000a999000000aa00a990000000aa000000099a00000000000000000000000000000000000000000000000000000000000000000
00000000009a000000a99a000000a900000000000aa00000000aa00000000aa00000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000a00000000000000a00000000000000000000000000000000000000000000000000000000000000000000
00a000000000aa00000aa00000aa000000000a000000990000a99a00009900000000000000000000000000000000000000000000000000000000000000000000
00999a0000099a000009900000a9900000a99900000999a0000990000a9990000000000000000000000000000000000000000000000000000000000000000000
00999a000a99900000099000000999a000a9990000a990000009900000099a000000000000000000000000000000000000000000000000000000000000000000
00a000000099000000a99a000000990000000a0000aa0000000aa0000000aa000000000000000000000000000000000000000000000000000000000000000000
00000000000a0000000000000000a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
