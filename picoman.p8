pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
function _init()
	plr={}
	plr.x=64
	plr.y=70
	plr.sp=1
	plr.cardir=0
	
	wld={}
	wld.ox=7
	wld.oy=1
	wld.cw=18
	wld.ch=20
	wld.csz=6 --cell size
end

function _update()
	if (btn(0)) plr.cardir=3
	if (btn(1)) plr.cardir=1
	if (btn(2)) plr.cardir=2
	if (btn(3)) plr.cardir=4
	
	local dx,dy=0,0
	local d=plr.cardir
	if d==1 then
		dx=1
		if point_solid(plr.x+dx+3,
			plr.y)
		then
			dx=0
			plr.cardir=0
		end
	elseif d==2 then
		dy=-1
		if point_solid(plr.x+dx+3,
			plr.y)
		then
			dx=0
			plr.cardir=0
		end
	elseif d==3 then
		dx=-1
		if point_solid(plr.x+dx+3,
			plr.y)
		then
			dx=0
			plr.cardir=0
		end
	elseif d==4 then
		dy=1
		if point_solid(plr.x+dx+3,
			plr.y)
		then
			dx=0
			plr.cardir=0
		end
	end
	
	if point_solid(plr.x+dx,
		plr.y+dy)
	then
		dx=0
		dy=0
		plr.cardir=0
	end
	
	plr.x+=dx
	plr.y+=dy
	
	plr.sp+=1
	if (plr.sp>2) plr.sp=1
end

function _draw()
	cls()
	ox=wld.ox
	oy=wld.oy
	for x=0,wld.cw do
		for y=0,wld.ch do
			local m=mget(x,y)
			if m>0 then
				spr(m,x*6+ox,y*6+oy)
			end
		end
	end
	
	spr(plr.sp,plr.x-3,plr.y-3)
end

function point_solid(x,y)
	local cx,cy=world_to_cell(x,y)
	return cell_solid(cx,cy)
end

function world_to_cell(wx,wy)
	return (wx-wld.ox)/wld.csz,
		(wy-wld.oy)/wld.csz
end

function cell_solid(cx,cy)
	return fget(mget(cx,cy),0)
end
__gfx__
0000000000aa000000aa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000aaaa0000aaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700aaaaaa00aaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000aaaaaa00aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000aaaa0000aaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000aa000000aa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c0000c00cccccc00cccccc00cccccc00cccccc00c0000c00cccccc00c0000c00c0000c00cccccc00cccccc00c0000c00c0000c00c0000c00cccccc00c0000000
c0000c000000000000000c00c0000000c0000c00c0000c00c0000000c000000000000c0000000c0000000000c00000000000000000000c00c0000000c0000000
c0000c000000000000000c00c0000000c0000c00c0000c00c0000000c000000000000c0000000c0000000000c00000000000000000000c00c0000000c0000000
c0000c000000000000000c00c0000000c0000c00c0000c00c0000000c000000000000c0000000c0000000000c00000000000000000000c00c0000000c0000000
c0000c000000000000000c00c0000000c0000c00c0000c00c0000000c000000000000c0000000c0000000000c00000000000000000000c00c0000000c0000000
c0000c00cccccc00cccccc00cccccc00c0000c00cccccc00c0000c00cccccc00cccccc00c0000c00c0000c00c0000c00cccccc00c0000c00c0000000cccccc00
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000c00cccccc00c000000000000c00cccccc000000000022222200000000000000000000000000000000000000000000000000000000000000000000000000
00000c0000000c00c000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000c0000000c00c000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000c0000000c00c000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000c0000000c00c000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cccccc0000000c00c000000000000c0000000000cccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000001010101010101010101010101010101010101010101030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1611111111111111111a11111111111111111900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000001000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000131200131112001500131112001312001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000131200140013111a11120014001312001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000100000001000000010000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1b111119001b111200150013111d001611111d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000001000100000000000000010001000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
171111180015001e242624210015001711111800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000022000000230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
161111190014001f252525200014001611111900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000001000100000000000000010001000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1b11111800150013111a11120015001711111d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000001000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000131900131112001500131112001612001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000001000000000000000000000001000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1b12001500140013111a11120014001500131d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000100000001000000010000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
10001311111c111200150013111c111112001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1711111111111111111111111111111111111800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
